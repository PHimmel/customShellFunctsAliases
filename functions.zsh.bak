#!/bin/zsh

function security () {

# set local lynis directory
local lynisDir="${HOME}/bin/lynis"

# start lynis full system analysis
cd ${lynisDir}
sudo ${lynisDir}/lynis audit system

# return to ~
cd

# malware scan, show only warnings
echo "\n\nMalware Scanning Started\n\n"
sudo rkhunter --cronjob --report-warnings-only

# analysis of installed pacman packages, shows level of issue of package if there is one
echo "\n\nPackage Vulernability Assessment Started"
arch-audit

# AIDE program options
#
# compares current filesystem database with current filesystem
echo "\n\nCompelete Root File System Modification Audit Started\n\n"
sudo aide

# creates a new database of total filesystem 
# sudo aide -i
#
# compares and updates new filesystem database with previous one
# sudo aide -u 

# give option to view total malware log file
echo "\n\nEnter 'Y' ro view malware log file\n\n" ; read cont

if [[ ${cont} -eq 'Y' ]] ; then
sudo less /var/log/rkhunter.log ; fi

# Finished
printf "\n\nDone!\n\n"
}

function update () { 

    function _pack_test() {
        local PACK=$1

        type $PACK && echo "\n${PACK}\n" && return 0 || return 1
    }

_pack_test "pacman" && (sudo pacman -Syu)

_pack_test "yay" && (yay -Syu)

_pack_test "snap" && (sudo snap refresh)

_pack_test "flatpak" && (flatpak update)

echo '\nDone with updates\nWould you like to run a full security check now?\nEnter 'Y' to continue.\n'
read cont

if [[ $cont = "Y" ]] ; then
    security
else echo "\n Okay all done! :D\n" ; fi

}

: '

OLD TEST CODE

function _package_manager_test () {
(which ${1})>/dev/null
if [[ ${?} -eq 0 ]] ; then
    return true
else
    return false
fi
}
# function update () { 
#    local PACK CMD # pack_test=`if [[ ${_package_manager_test $($PACK)} ]] ; then ; echo "\n${PACK}\n" ; ${CMD} ; fi`

#function _package_manager_test () {
#if which ${1}>/dev/null ; then # >/dev/null
# RESULT=$?
# if [ ${RESULT} -eq 0 ] ; then
#    return 1
#else
 #   return 111
#fi
#}
#PACK=pacman
#CMD=(sudo pacman -Syu)
#tester=`_package_manager_test pacman`
#echo "$tester"
#if [[ $(_package_manager_test ${PACK}) -eq 1 ]] ; then ; echo kkkk ; fi
#    local PACK CMD pack_test=`if [[ ${_package_manager_test $($PACK)} ]] ; then ; echo "\n${PACK}\n" ; ${CMD} ; fi`
#$pack_test
#echo "pacman" ; sudo pacman -Syu

'
